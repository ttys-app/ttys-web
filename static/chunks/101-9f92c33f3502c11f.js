(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[101],{2987:(e,t,r)=>{"use strict";r.d(t,{default:()=>N});var a=r(5155),l=r(2115),s=r(2515),n=r(5695),o=r(190),i=r(40),c=r(5113);let d={},u={},g=(e,t)=>{let{...r}=e,a=[];return Object.entries(r).forEach(e=>{a.push(""!==e[1]?"".concat(e[0],"=").concat(e[1]):"")}),(0,c.A)({url:"".concat(i.VT,"/videos/playList?").concat(a.join("&"),"&playable=1")},t)},y=(e,t)=>{let{...r}=e,{requestId:a,...l}=r,s=JSON.stringify(l);return u[s]&&Date.now()-u[s].timestamp<5e3?(console.log("\uD83D\uDCE6 从缓存加载数据:",s),Promise.resolve(u[s].data)):(d[s]||(d[s]=g(l,t).then(e=>(e&&(u[s]={data:e,timestamp:Date.now()}),e)).finally(()=>{setTimeout(()=>{delete d[s]},100)})),d[s])};var m=r(7810);let f={movie:"0",tv:"1",anime:"2","short-drama":"8"},h=e=>{let{tabType:t,filters:r={},initialData:a,locale:s=m.Xn}=e,[n,o]=(0,l.useState)(a?{videos:a.videos,hasMore:a.hasMore,total:a.total}:null),[i,c]=(0,l.useState)(0),[d,u]=(0,l.useState)(t),[g,h]=(0,l.useState)(JSON.stringify(r)),p=(0,l.useRef)(!1),x=(0,l.useRef)(!0),v=(0,l.useRef)(!1),b=(0,l.useRef)(r);(0,l.useEffect)(()=>{b.current=r},[r]);let w=(0,l.useRef)(0);(0,l.useMemo)(()=>"videos-".concat(t,"-").concat(JSON.stringify(r),"-").concat(s),[t,r,s]),(0,l.useEffect)(()=>{let e=JSON.stringify(r);(d!==t||g!==e)&&(u(t),h(e),w.current=0,p.current=!1,x.current=!0,a&&d!==t?o({videos:a.videos,hasMore:a.hasMore,total:a.total}):o(null),v.current=!0,c(e=>e+1))},[t,r,a,d,g]);let j=(0,l.useCallback)(async e=>{if(p.current&&e>1)return null;p.current=!0;try{let r={videoType:"8"===f[t]?"3":"0",artType:f[t],pageIndex:e,pageSize:18};b.current.region&&"all"!==b.current.region&&(r.area=b.current.region),b.current.year&&"all"!==b.current.year&&(r.releaseYear=b.current.year),"short-drama"===t?b.current.type&&"all"!==b.current.type&&(r.reelsContentType=b.current.type):b.current.type&&"all"!==b.current.type&&(r.contentType=b.current.type);let a=await y(r),l=a.list.length,n=(e-1)*r.pageSize+l<a.total&&l===r.pageSize,o=a.list.map((t,r)=>{var a;let l="cn"===s||"tw"===s?t.name:null!=(a=t.nameEn)?a:t.name;return{id:t.ID||String(t.ID)||"item-".concat(e,"-").concat(r),title:l,cover:t.coverSrc||t.coverHSrc||"",description:t.introduction||t.summary||"",score:t.score?parseFloat(t.score):0,year:t.releaseYear||t.release_year||"",category:t.contentType||t.content_type||t.reelsContentType||t.reels_content_type||"",region:t.area||"",updateInfo:t.lastWatchSet||t.last_watch_set||"",tags:[]}});return x.current=!1,{videos:o,hasMore:n,total:a.total||0,page:e}}catch(t){return console.error("获取视频列表失败:",t),{videos:[],hasMore:!1,total:0,page:e,error:t instanceof Error?t.message:"未知错误"}}finally{p.current=!1}},[t,s]),[_,k]=(0,l.useState)({videos:(null==a?void 0:a.videos)||[],hasMore:(null==a?void 0:a.hasMore)||!1,isLoading:!1,error:null,total:(null==a?void 0:a.total)||0}),N=(0,l.useCallback)(async()=>{if(!p.current&&_.hasMore){k(e=>({...e,isLoading:!0}));try{let e=w.current+1,t=await j(e);if(!t||t.error)throw Error((null==t?void 0:t.error)||"加载失败");w.current=e,k(e=>{let r=new Map;return e.videos.forEach(e=>{r.set(e.id,e)}),t.videos.forEach(e=>{r.set(e.id,e)}),{videos:Array.from(r.values()),hasMore:t.hasMore,isLoading:!1,error:null,total:t.total}})}catch(e){console.error("加载更多失败:",e),k(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"加载失败"}))}}},[_.hasMore,j]),S=(0,l.useCallback)(async()=>{w.current=0,p.current=!0,k(e=>({...e,isLoading:!0,error:null,videos:[]}));try{let e=await j(0);if(!e||e.error)throw Error((null==e?void 0:e.error)||"加载失败");k({videos:e.videos,hasMore:e.hasMore,isLoading:!1,error:null,total:e.total})}catch(e){console.error("重新加载失败:",e),k(t=>({...t,isLoading:!1,error:e instanceof Error?e.message:"加载失败"}))}},[j]);(0,l.useEffect)(()=>{if(v.current){v.current=!1,S();return}if(a&&x.current&&n){k({videos:n.videos,hasMore:n.hasMore,isLoading:!1,error:null,total:n.total}),x.current=!1;return}x.current&&S()},[a,n,S,i]);let C=(0,l.useCallback)(()=>S(),[S]),M=0===_.videos.length&&!_.isLoading;return{videos:_.videos,hasMore:_.hasMore,total:_.total,isLoading:_.isLoading,isLoadingMore:_.isLoading&&w.current>1,isEmpty:M,error:_.error,loadMore:N,handleFilterChange:C,currentPage:w.current}};var p=r(7309),x=r(5964),v=r.n(x);function b(e){let{categories:t=[],tabType:r,translations:s}=e,[c,d]=(0,l.useState)(0),u=(0,l.useRef)(null),{filter:g,setFilter:y,updateFilter:m,activeCategory:f,activeRegion:h,activeYear:x,activeType:b}=(0,o.A)();(0,n.useRouter)(),(0,n.usePathname)();let w=(0,n.useSearchParams)(),j=(0,l.useRef)(!1),_=(0,l.useRef)(""),k=(0,l.useRef)(!1);(0,l.useRef)(g),(0,l.useRef)(Object.keys(g).length);let N=(0,l.useRef)(!1),S=(0,l.useCallback)(e=>{let t=e.toLowerCase(),r=s.category_type?s.category_type.toLowerCase():"",a=s.category_region?s.category_region.toLowerCase():"",l=s.category_year?s.category_year.toLowerCase():"";return"category"===t||"类型"===t||r&&t===r?"type":"region"===t||"地区"===t||a&&t===a?"region":"year"===t||"年份"===t||"release_year"===t||l&&t===l?"year":t},[s]),C=(0,l.useCallback)((e,r)=>{if("all"===r)return"all";let a=t.find(t=>S(t.title)===e);if(!a)return r;let l=a.items.find(e=>e.id===r);return l?l.name:r},[t,S]),M=(0,l.useCallback)((e,r)=>{if("all"===r)return"all";let a=t.find(t=>S(t.title)===e);if(!a)return r;let l=a.items.find(e=>e.name===r);return l?l.id:r},[t,S]);(0,l.useEffect)(()=>{if(!k.current&&(!j.current||w.toString()!==_.current)){j.current=!0,_.current=w.toString();let e=w.get("type")||"all",t=w.get("region")||"all",a=w.get("year")||"all",l=M("type",e),s=M("region",t),n=M("year",a),o={};"all"!==l&&(o.type=l),"short-drama"!==r&&("all"!==s&&(o.region=s),"all"!==n&&(o.year=n)),JSON.stringify(o)!==JSON.stringify(g)&&y(o)}},[w,y,r,M]),(0,l.useEffect)(()=>{if(!j.current)return;let e=Object.keys(g).length>0,t=w.toString().length>0;if(N.current||e&&!t){let e=new URLSearchParams,t=o.A.getState().filter;if(t.type&&"all"!==t.type){let r=C("type",t.type);e.set("type",r)}if("short-drama"!==r){if(t.region&&"all"!==t.region){let r=C("region",t.region);e.set("region",r)}if(t.year&&"all"!==t.year){let r=C("year",t.year);e.set("year",r)}}let a=e.toString();if(a!==w.toString()){k.current=!0,_.current=a;try{let e=new URL(window.location.href);e.search=a,window.history.replaceState(window.history.state,"",e.toString())}catch(e){console.error("更新URL失败:",e)}setTimeout(()=>{k.current=!1,N.current=!1},50)}else N.current=!1}},[g]),(0,l.useCallback)(()=>{let e=M("type",w.get("type")||"all");if((g.type||"all")!==e)return!1;if("short-drama"!==r){let e=M("region",w.get("region")||"all");if((g.region||"all")!==e)return!1;let t=M("year",w.get("year")||"all");if((g.year||"all")!==t)return!1}return!0},[g,w,r,M]);let L=v()(e=>{if(!k.current){k.current=!0,_.current=e;try{let t=new URL(window.location.href);t.search=e,window.history.replaceState(window.history.state,"",t.toString())}catch(e){console.error("更新URL失败:",e)}setTimeout(()=>{k.current=!1},50)}},50);(0,l.useCallback)(()=>{setTimeout(()=>{let e=document.querySelector(".video-list .grid > *:first-child");if(e)e.scrollIntoView({behavior:"smooth",block:"start"});else{let e=document.querySelector(".video-list");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}},300)},[]);let R=(0,l.useCallback)((e,t)=>{N.current=!0,m(t,e),setTimeout(()=>{let e=new URLSearchParams,t=o.A.getState().filter;if(t.type&&"all"!==t.type){let r=C("type",t.type);e.set("type",r)}if("short-drama"!==r){if(t.region&&"all"!==t.region){let r=C("region",t.region);e.set("region",r)}if(t.year&&"all"!==t.year){let r=C("year",t.year);e.set("year",r)}}L(e.toString())},0)},[m,r,C,L]),T=e=>{d(e),E(e)},E=e=>{if(u.current){let t=u.current,r=t.children[e];if(r){let e=r.offsetLeft-t.clientWidth/2+r.clientWidth/2;t.scrollTo({left:e,behavior:"smooth"})}}},P=(0,p.uh)({onSwipedLeft:()=>{c<t.length-1&&T(c+1)},onSwipedRight:()=>{c>0&&T(c-1)},trackMouse:!1}),A=e=>{let t=e.toLowerCase(),r=s.category_type?s.category_type.toLowerCase():"",a=s.category_region?s.category_region.toLowerCase():"",l=s.category_year?s.category_year.toLowerCase():"";return"category"===t||"类型"===t||r&&t===r?s.category_type||e:"region"===t||"地区"===t||a&&t===a?s.category_region||e:("year"===t||"年份"===t||"release_year"===t||l&&t===l)&&s.category_year||e},O=e=>{switch(e){case"type":return f;case"region":return h;case"year":return x;default:return"all"}};return t&&0!==t.length?(0,a.jsxs)("div",{className:"category-tabs",children:[(0,a.jsx)("div",{className:"relative border-b border-gray-200 dark:border-gray-700",children:(0,a.jsx)("div",{ref:u,className:"flex overflow-x-auto hide-scrollbar px-4 gap-4 whitespace-nowrap",children:t.map((e,t)=>(0,a.jsx)("button",{className:"pb-1 px-1 text-sm font-medium transition-colors duration-200 ".concat(t===c?"text-[".concat(i.ql,"] border-b-2 border-[").concat(i.ql,"]"):"text-gray-600 dark:text-gray-400"),onClick:()=>T(t),children:A(e.title)},e.title))})}),(0,a.jsx)("div",{...P,className:"mt-2",children:t.map((e,t)=>{let r=S(e.title),l=O(r);return(0,a.jsx)("div",{className:"".concat(t===c?"block":"hidden"),children:(0,a.jsx)("div",{className:"flex flex-wrap px-4 gap-2 py-1",children:e.items.map(e=>{let t=l===e.id;return(0,a.jsx)("button",{className:"px-3 py-1 text-xs rounded-full transition-colors duration-200 ".concat(t?"bg-neutral-300 font-bold text-[".concat(i.ql,"] dark:bg-neutral-700 dark:text-[rgba(").concat("0,91,219",",0.9)]"):"bg-neutral-200 text-neutral-600 dark:bg-neutral-800 dark:text-gray-400"),onClick:()=>R(e.id,r),children:e.name},e.id)})})},e.title)})})]}):(0,a.jsx)("div",{className:"category-tabs"})}var w=r(6766);let j=l.memo(function(e){let{video:t,tabType:r,showDownloadTip:i,translations:c,isFirstPage:d=!1}=e,u=(0,n.useRouter)(),{addPlayHistory:g}=(0,o.A)(),[y,m]=(0,l.useState)(!1),f=(0,l.useCallback)(()=>{if("short-drama"===r){null==i||i();return}g({id:t.id,title:t.title,poster:t.cover,category:t.category,year:t.year,region:t.region}),u.push("/detail/".concat(t.id))},[t,r,i,u,g]),h=(0,l.useCallback)(()=>{m(!0)},[]),p=c.general_no_image||"无图片";return(0,a.jsxs)("div",{className:"video-card relative w-full pb-2 cursor-pointer",onClick:f,children:[(0,a.jsxs)("div",{className:"poster-wrapper relative aspect-[2/3] overflow-hidden rounded-lg mb-2 bg-gray-200 dark:bg-neutral-800",children:[y?(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-300 dark:bg-gray-700",children:(0,a.jsx)("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:p})}):(0,a.jsx)(w.default,{src:t.cover,alt:t.title,fill:!0,sizes:"(max-width: 768px) 33vw, 20vw",className:"object-cover transition-transform duration-300 hover:scale-110",onError:h,priority:d,unoptimized:"short-drama"===r}),(0,a.jsx)("div",{className:"play-overlay absolute inset-0 flex items-center justify-center opacity-0 bg-black bg-opacity-40 transition-opacity duration-300 hover:opacity-100",children:(0,a.jsx)(s.QTv,{className:"text-white text-5xl"})})]}),(0,a.jsx)("h3",{className:"text-sm font-medium truncate text-center",children:t.title})]})},(e,t)=>e.video.id===t.video.id&&e.tabType===t.tabType&&e.isFirstPage===t.isFirstPage&&e.translations.general_no_image===t.translations.general_no_image);var _=r(6742);let k=l.memo(function(e){let{videos:t=[],loadMore:r,isLoading:n=!1,isLoadingMore:o=!1,isEmpty:c=!1,hasError:d=!1,hasMore:u=!0,tabType:g,emptyMessage:y="没有找到相关视频",translations:m,currentPage:f=0,itemsPerPage:h=24}=e,[p,x]=(0,l.useState)(!1),v=(0,l.useRef)(null),b=(0,l.useRef)(null);(0,l.useRef)(t.length);let w=(0,l.useRef)(null),k=(0,l.useMemo)(()=>({...m,general_no_image:m.general_no_image||"无图片",general_loading:m.general_loading||"加载中...",general_net_fault:m.general_net_fault||"网络错误",general_retry:m.general_retry||"重试"}),[m]);(0,l.useEffect)(()=>{if(b.current)return v.current=new IntersectionObserver(e=>{e[0].isIntersecting&&!n&&!o&&u&&r()},{threshold:.1}),v.current.observe(b.current),()=>{v.current&&v.current.disconnect()}},[n,o,u,r]);let N=(0,l.useCallback)(()=>{x(!0)},[]),S=(0,l.useCallback)(()=>{x(!1)},[]),C=(0,l.useCallback)(()=>{r()},[r]);return(0,a.jsxs)("div",{className:"video-list p-4",ref:w,children:[!c||n||d?(0,a.jsx)("div",{className:"grid grid-cols-3 gap-4",children:t.map((e,t)=>(0,a.jsx)(j,{video:e,tabType:g,showDownloadTip:N,translations:k,isFirstPage:0===f&&t<h},"".concat(e.id,"-").concat(t)))}):(0,a.jsx)("div",{className:"empty-state flex flex-col items-center justify-center py-12",children:(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:y})}),(n||o)&&(0,a.jsxs)("div",{className:"loading flex justify-center items-center p-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-[".concat(i.ql,"]")}),(0,a.jsx)("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:k.general_loading})]}),d&&(0,a.jsxs)("div",{className:"error-state flex flex-col items-center justify-center py-4",children:[(0,a.jsx)("p",{className:"text-red-500 dark:text-red-400 mb-2",children:k.general_net_fault}),(0,a.jsxs)("button",{className:"flex items-center px-4 py-2 bg-[".concat(i.ql,"] text-white rounded-full"),onClick:C,children:[(0,a.jsx)(s.joZ,{className:"mr-1"}),k.general_retry]})]}),u&&!d&&(0,a.jsx)("div",{ref:b,className:"h-4 w-full"}),(0,a.jsx)(_.A,{isOpen:p,onClose:S,translations:m,modalType:"short-drama"===g?"short":"default"})]})}),N=l.memo(function(e){let{tabType:t,title:r,categories:i,translations:c,initialData:d}=e,u=(0,n.useRouter)(),{setCurrentTab:g,filter:y,settings:m}=(0,o.A)(),f=(0,l.useMemo)(()=>({type:y.type||"all",region:y.region||"all",year:y.year||"all"}),[y.type,y.region,y.year]),{videos:p,hasMore:x,isLoading:v,isLoadingMore:w,isEmpty:j,error:_,loadMore:N,handleFilterChange:S,currentPage:C}=h((0,l.useMemo)(()=>({tabType:t,filters:f,initialData:d,locale:m.language}),[t,f,d,m.language])),M=(0,l.useCallback)(()=>{u.push("/search")},[u]),L=(0,l.useCallback)(()=>{switch(t){case"movie":return c.artTypeFilm;case"tv":return c.artTypeTeleplay;case"anime":return c.artTypeEntertainment;case"short-drama":return c.artTypeVariety;default:return r}},[t,c,r]),R=(0,l.useMemo)(()=>({videos:p,loadMore:N,isLoading:v,isLoadingMore:w,isEmpty:j,hasError:!!_,hasMore:x,tabType:t,emptyMessage:c.main_noData,translations:c,currentPage:C||0}),[p,N,v,w,j,_,x,t,c,C]),T=(0,l.useMemo)(()=>({categories:i,tabType:t,translations:c}),[i,t,c]);return(0,a.jsxs)("div",{className:"video-list-page",children:[(0,a.jsxs)("div",{className:"sticky top-0 z-10 bg-white dark:bg-neutral-900 shadow-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-2",children:[(0,a.jsx)("h1",{className:"text-xl font-bold",children:L()}),(0,a.jsx)("button",{className:"p-2 rounded-full bg-neutral-100 dark:bg-neutral-800",onClick:M,children:(0,a.jsx)(s.EO$,{size:20})})]}),(0,a.jsx)(b,{...T})]}),(0,a.jsx)(k,{...R})]})})},4101:(e,t,r)=>{Promise.resolve().then(r.bind(r,2987))},6742:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var a=r(5155),l=r(2115),s=r(1013),n=r(9911),o=r(40);function i(e){let{isOpen:t,onClose:r,translations:i,appLink:c,videoTitle:d="",modalType:u="default"}=e,[g,y]=(0,l.useState)("unknown"),[m,f]=(0,l.useState)(o.iz);if((0,l.useEffect)(()=>{let e=(()=>{let e=navigator.userAgent||navigator.vendor||window.opera||"";return/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"ios":/android/i.test(e)?"android":"unknown"})();y(e),"ios"===e?f(c||o.M$):"android"===e?f(c||o.Q8):f(c||o.iz)},[c]),!t)return null;let h="download_app_title",p="download_app_desc";"short"===u?(h="download_app_short_title",p="download_app_short_desc"):"detail"===u&&(h="download_app_detail_title",p="download_app_detail_desc");let x=i[h]||i.downloadTitle||"下载APP观看完整内容",v=i[p]||i.downloadDesc||"安装APP即可观看全部高清视频，无广告，支持离线缓存";d&&"detail"===u&&(v=v.replace("{title}",d));let b=i.download_app_btn||i.downloadBtn||"立即下载",w=i.download_app_cancel||i.cancelBtn||"取消";return(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-70",onClick:r}),(0,a.jsxs)("div",{className:"relative w-[90%] max-w-[300px] bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden z-10",children:[(0,a.jsx)("button",{onClick:r,className:"absolute top-3 right-3 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:(0,a.jsx)(s.LwM,{className:"text-2xl"})}),(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-center mb-4",children:x}),(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)("div",{className:"w-16 h-16 rounded-full bg-orange-100 dark:bg-orange-900 flex items-center justify-center",children:"ios"===g?(0,a.jsx)(n.eMv,{className:"text-3xl text-orange-500"}):"android"===g?(0,a.jsx)(n.DGu,{className:"text-3xl text-orange-500"}):(0,a.jsx)(n.WCW,{className:"text-2xl text-orange-500"})})}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300 text-center mb-6",children:v}),(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)("button",{onClick:()=>{window.open(m,"_blank")},className:"w-full py-2.5 bg-[#FD4F1D] text-white rounded-full font-medium flex items-center justify-center",children:["ios"===g?(0,a.jsx)(n.eMv,{className:"text-lg mr-2"}):"android"===g?(0,a.jsx)(n.DGu,{className:"text-lg mr-2"}):(0,a.jsx)(n.WCW,{className:"text-lg mr-2"}),b]}),(0,a.jsx)("button",{onClick:r,className:"w-full py-2.5 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-full font-medium",children:w})]})]})]})]})}}}]);